import{u as e,b as l}from"./chunk-CK6zyU60.js";import{b as s,s as a,r as t,h as o,o as n,e as i,f as r,z as d,j as p,k as c,F as b,a6 as m,a7 as u,a8 as g}from"./chunk-CuXAu-_P.js";import{r as f}from"./chunk-Cv_h2SVa.js";import{_ as x}from"./chunk-DmehfYk3.js";const h={class:"modal-box"},y=r("h3",{class:"text-lg font-bold"},"提示!",-1),k=r("p",{class:"py-4"},"该操作会清空人员中奖信息，是否继续？",-1),_={class:"modal-action"},v={method:"dialog",class:"flex gap-3"},A={class:"modal-box"},C=r("h3",{class:"text-lg font-bold"},"提示!",-1),j=r("p",{class:"py-4"},"该操作会删除所有人员数据，是否继续？",-1),N={class:"modal-action"},z={method:"dialog",class:"flex gap-3"},P={class:"min-w-1000px"},S=r("h2",null,"人员管理",-1),w={class:"flex gap-3"},W=r("div",{class:"tooltip tooltip-bottom","data-tip":"下载文件后，请在excel中填写数据，并保存为xlsx格式"},[r("a",{class:"no-underline btn btn-secondary btn-sm",download:"人口登记表.xlsx",target:"_blank",href:"/log-lottery/人口登记表.xlsx"},"下载模板")],-1),D={class:""},T={for:"explore"},J={class:"tooltip tooltip-bottom","data-tip":"上传修改好的excel文件"},O=r("span",{class:"btn btn-primary btn-sm"},"导入人员数据",-1),L=r("span",null,"中奖人数：",-1),M=r("span",null," / ",-1),F=s({__name:"PersonAll",setup(s){const F=e().personConfig,{getAllPersonList:I,getAlreadyPersonList:V}=a(F),q=t(),B=t(),E=async e=>{let s=await f(e.target.files[0]),a=m(s,{type:"binary",cellDates:!0}),t=a.Sheets[a.SheetNames[0]];const o=u.sheet_to_json(t),n=l(o);F.resetPerson(),F.addNotPersonList(n)},G=()=>{let e=JSON.parse(JSON.stringify(I.value));for(let s=0;s<e.length;s++)delete e[s].x,delete e[s].y,delete e[s].id,delete e[s].createTime,delete e[s].updateTime,delete e[s].prizeId,e[s].isWin?e[s].isWin="是":e[s].isWin="否",e[s].prizeTime=e[s].prizeTime.join(","),e[s].prizeName=e[s].prizeName.join(",");let l=JSON.stringify(e);if(l=l.replaceAll(/uid/g,"编号").replaceAll(/isWin/g,"是否中奖").replaceAll(/department/g,"部门").replaceAll(/name/g,"姓名").replaceAll(/identity/g,"身份").replaceAll(/prizeName/g,"获奖").replaceAll(/prizeTime/g,"获奖时间"),e=JSON.parse(l),e.length>0){const l=u.json_to_sheet(e),s=u.book_new();u.book_append_sheet(s,l,"Sheet1"),g(s,"data.xlsx")}},H=()=>{F.resetAlreadyPerson()},K=()=>{F.deleteAllPerson()},Q=[{label:"编号",props:"uid"},{label:"姓名",props:"name"},{label:"部门",props:"department"},{label:"身份",props:"identity"},{label:"是否已中奖",props:"isWin",formatValue:e=>e.isWin?"是":"否"},{label:"操作",actions:[{label:"删除",type:"btn-error",onClick:e=>{(e=>{F.deletePerson(e)})(e)}}]}];return o((()=>{})),(e,l)=>(n(),i(b,null,[r("dialog",{id:"my_modal_1",ref_key:"resetDataDialog",ref:q,class:"border-none modal"},[r("div",h,[y,k,r("div",_,[r("form",v,[r("button",{class:"btn",onClick:l[0]||(l[0]=e=>q.value.close())},"取消"),r("button",{class:"btn",onClick:H},"确定")])])])],512),r("dialog",{id:"my_modal_1",ref_key:"delAllDataDialog",ref:B,class:"border-none modal"},[r("div",A,[C,j,r("div",N,[r("form",z,[r("button",{class:"btn",onClick:l[1]||(l[1]=e=>B.value.close())},"取消"),r("button",{class:"btn",onClick:K},"确定")])])])],512),r("div",P,[S,r("div",w,[r("button",{class:"btn btn-error btn-sm",onClick:l[2]||(l[2]=e=>B.value.showModal())},"全部删除"),W,r("div",D,[r("label",T,[r("div",J,[r("input",{type:"file",class:"",id:"explore",style:{display:"none"},onChange:E,accept:".xlsx,.xls"},null,32),O])])]),r("button",{class:"btn btn-error btn-sm",onClick:l[3]||(l[3]=e=>q.value.showModal())},"重置人员数据"),r("button",{class:"btn btn-accent btn-sm",onClick:G},"导出结果"),r("div",null,[L,r("span",null,d(p(V).length),1),M,r("span",null,d(p(I).length),1)])]),c(x,{tableColumns:Q,data:p(I)},null,8,["data"])])],64))}});export{F as default};
